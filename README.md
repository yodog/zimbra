# About

This repository is a collection of Zimbra scripts created in the past years of email server administration. While Zimbra is the main focus, you will also find cyrus, postfix, sendmail and others. a Python script designed to retrieve and summarize user account information from a Zimbra email server using LDAP (Lightweight Directory Access Protocol). This tool can be particularly useful for administrators looking to manage and audit user accounts effectively.

Disclaimer: this README.md file is generated by AI.

# Installation Instructions

1. **Clone the Repository**

```bash
git clone https://github.com/yodog/zimbra.git
cd zimbra
```

2. **Dependencies**

Ensure you have Python installed. You may need to install additional dependencies such as the `ldap` module. Use `pip` for package management:

```bash
pip install python-ldap
```

# Operating Instructions

To run the main script, execute the following command:

```bash
python zmb-domain-summary.py
```

You can also use the following options:

-l or --loglevel: Change the verbosity level (default: WARN)
-s or --sendmail: Send the result via email
-t or --testmode: Activate test mode (quick run)

Ex: you can customize the logging level and whether to send the results via email using command-line arguments:

```bash
python zmb-domain-summary.py --loglevel INFO --sendmail
```

# Troubleshooting Instructions

If you encounter issues running the scripts:

- Ensure Python and the necessary packages are correctly installed.
- Verify your LDAP server settings and ensure credentials are correct.
- Check network connectivity to the LDAP server.

# File Manifest

- README.md: This documentation file.
- zmb-domain-summary.py: script used for retrieving Zimbra account summaries.
- test-connection.py: script to test connectivity to the Zimbra server.

## zmb-domain-summary.py

The `zmb-domain-summary.py` script generates a summary report of Zimbra accounts, categorized by domain. The report includes counts of active, closed, locked, maintenance, total, admin, delegated admin, system, and pending accounts.

1. **Establish LDAP Connection**: The script connects to the Zimbra LDAP server using specified credentials.
2. **Retrieve User Accounts**: It fetches all Zimbra user accounts and their relevant attributes, filtering out non-user accounts.
3. **Create Domain Database**: Constructs a database indexed by domain, categorizing users based on their email addresses.
4. **Generate Summary**: Compiles a summary of user accounts, counting active, closed, locked, and other account status types.
5. **Print and Send Results**: Formats the summary for display and can optionally send it via email.

Key Functions:

- `createLdapConn()`: Establishes a connection to the LDAP server.
- `zmbGetAllAccounts()`: Retrieves all user accounts from the Zimbra server.
- `createDomainDatabase()`: Constructs a database indexed by email domains.
- `createSummaryArray()`: Generates a summary of accounts by status.
- `printTable()`: Formats and prints the summary as a table.
- `sendMail()`: Sends the summary report via email if requested.

## test-connection.py

The `test-connection.py` script is intended to verify connectivity to the Zimbra server. Although the exact implementation details are not available, it typically performs the following tasks:

1. **Establish Connection**:  The script attempts to connect to the Zimbra server using provided credentials and server details.
2. **Check Response**: It checks whether the server responds appropriately, indicating whether the connection is successful.
3. **Output Result**: Outputs the result of the connection test, providing feedback to the user on the connection status.
